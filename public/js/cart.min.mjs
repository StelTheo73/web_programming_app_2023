"use strict";import{showOrder as e}from"./order.min.mjs";let BLOCK_SESSION_STORAGE=!1,CART_OVERLAY=document.querySelector("#cart-overlay-container"),CART_ITEMS_WRAPPER=document.querySelector("#cart-overlay-container > .custom-overlay-content .cart-items-wrapper"),TITLE_DIV=CART_ITEMS_WRAPPER.querySelector(".cart-item-title"),CONTINUE_TO_ORDER_BTN=document.querySelector("#cart-overlay-container > .custom-overlay-content .continue-to-order"),CLEAR_CART_BTN=document.querySelector("#cart-overlay-container > .custom-overlay-content .clear-cart"),POPUP=document.querySelector("#itemAddedPopup");function showPopup(e){POPUP.innerHTML=e,POPUP.removeAttribute("style"),POPUP.classList.add("show"),setTimeout(function(){POPUP.classList.remove("show")},1200)}function cartButtonListener(){document.querySelectorAll(".show-cart").forEach(e=>{e.addEventListener("click",function(){showItemsInCart()})}),document.querySelectorAll(".add-to-cart").forEach(e=>{e.addEventListener("click",function(){let t=e.parentNode,n=t.getAttribute("data-item-id"),r=t.querySelector("span > span:nth-child(1)").innerHTML,a=t.querySelector("span > span:nth-child(2)").innerHTML.split(" ")[0];addItemToCart(n,r,a)})}),CART_OVERLAY.querySelectorAll(".close-cart").forEach(e=>{e.addEventListener("click",function(){document.querySelector("#cart-overlay-container").classList.remove("show")})}),CART_OVERLAY.querySelectorAll(".continue-to-order").forEach(t=>{t.addEventListener("click",function(){CART_OVERLAY.classList.remove("show"),e()})}),CART_OVERLAY.querySelectorAll(".clear-cart").forEach(e=>{e.addEventListener("click",function(){clearCart()})})}function showEmptyCart(){let e=document.createElement("div"),t=document.createElement("span"),n=document.createTextNode("Το καλάθι σου είναι άδειο!");t.appendChild(n),e.appendChild(t),CART_ITEMS_WRAPPER.appendChild(TITLE_DIV),CART_ITEMS_WRAPPER.appendChild(e),CONTINUE_TO_ORDER_BTN.setAttribute("disabled","true"),CLEAR_CART_BTN.setAttribute("disabled","true")}function showItemsInCart(){let e=window.location.href.split("/")[4].replace("#","").replace("/","").substring(0,24),t=sessionStorage.getItem(e);if(CART_ITEMS_WRAPPER.innerHTML="",CART_OVERLAY.classList.add("show"),null==t||0===(t=JSON.parse(t)).length){showEmptyCart();return}for(let n of(CART_ITEMS_WRAPPER.appendChild(TITLE_DIV),CONTINUE_TO_ORDER_BTN.removeAttribute("disabled"),CLEAR_CART_BTN.removeAttribute("disabled"),t)){let r=document.createElement("div"),a=document.createElement("span"),i=document.createElement("span"),c=document.createElement("span"),o=document.createElement("span"),l=document.createElement("button"),s=document.createElement("button"),d=document.createTextNode(n.itemName),u=n.itemPrice*n.quantity;u=u.toFixed(2);let E=document.createTextNode(u+" €"),p=document.createTextNode(n.quantity);r.setAttribute("class","d-flex justify-content-between align-items-center cart-item my-2"),r.setAttribute("data-item-id",n.itemId),l.setAttribute("class","btn btn-outline-secondary increase-quantity-btn"),s.setAttribute("class","btn btn-outline-secondary decrease-quantity-btn"),l.addEventListener("click",function(e){changeQuantity("decrease",e)}),s.addEventListener("click",function(e){changeQuantity("increase",e)}),a.appendChild(d),i.appendChild(E),c.appendChild(p),l.innerHTML="-",s.innerHTML="+",o.appendChild(l),o.appendChild(c),o.appendChild(s),r.appendChild(a),r.appendChild(i),r.appendChild(o),CART_ITEMS_WRAPPER.appendChild(r)}}async function changeQuantity(e,t){for(;!0===BLOCK_SESSION_STORAGE;)await new Promise(e=>setTimeout(e,200));BLOCK_SESSION_STORAGE=!0;let n=window.location.href.split("/")[4].replace("#","").replace("/","").substring(0,24),r=t.target.parentNode.parentNode.getAttribute("data-item-id"),a=sessionStorage.getItem(n),i=[];if(null==a)return;i=JSON.parse(a);let c=findIndexOfItemInCart(r,i);"increase"===e?i[c].quantity++:"decrease"===e&&0==--i[c].quantity&&i.splice(c,1),i=JSON.stringify(i),sessionStorage.setItem(n,i),BLOCK_SESSION_STORAGE=!1,showItemsInCart()}async function addItemToCart(e,t,n){for(;!0===BLOCK_SESSION_STORAGE;)await new Promise(e=>setTimeout(e,200));BLOCK_SESSION_STORAGE=!0;let r=window.location.href.split("/")[4].replace("#","").replace("/","").substring(0,24),a={itemId:e,itemName:t,quantity:1,itemPrice:Number(n)},i=[],c=sessionStorage.getItem(r);if(null==c)i.push(a);else{i=JSON.parse(c);let o=findIndexOfItemInCart(a.itemId,i);o>=0?i[o].quantity+=1:i.push(a)}i=JSON.stringify(i),sessionStorage.setItem(r,i),BLOCK_SESSION_STORAGE=!1,showPopup("Το προϊόν προστέθηκε στο καλάθι")}async function clearCart(){for(;!0===BLOCK_SESSION_STORAGE;)await new Promise(e=>setTimeout(e,200));BLOCK_SESSION_STORAGE=!0;let e=window.location.href.split("/")[4].replace("#","").replace("/","").substring(0,24);sessionStorage.removeItem(e),BLOCK_SESSION_STORAGE=!1,showItemsInCart()}function findIndexOfItemInCart(e,t){let n=0;for(let r of t){if(r.itemId===e)return n;n++}return -1}export{showItemsInCart,cartButtonListener,clearCart};