"use strict";import{cartButtonListener as e}from"./cart.min.mjs";import{orderButtonListener as r}from"./order.min.mjs";import{userAddressesListener as t}from"./userItems.min.mjs";function updateLocalStorage(){let e=document.querySelector("#navbar-and-sidebar-wrapper > #main-navbar > header .address-dropdown"),r=e.innerHTML.trim();if(0===r.length)fillAddressDropdown(JSON.parse(localStorage.getItem("addresses")));else{let t=e.querySelectorAll(".address-dropdown-content > ul > li"),s=[];for(let a of t){let d,n={addressId:a.getAttribute("data-address-id"),addressText:a.innerHTML};s.push(n)}localStorage.setItem("addresses",JSON.stringify(s))}}function fillAddressDropdown(e){let r=document.querySelector("#navbar-and-sidebar-wrapper > #main-navbar > header .address-dropdown"),t=e[0];e=e.slice(1);let s=`
        <h6>Ενεργή διεύθυνση</h6>
        <li class="active-address address-dropdown-element" data-address-id=${t.addressId}>${t.addressText}</li>
        <hr class="my-1">
        <h6>Επιλογή διεύθυνσης</h6>`;e.forEach(e=>{s+=`<li class="address-dropdown-element my-1" data-address-id=${e.addressId}>${e.addressText}</li>`}),r.innerHTML=`
    <span class="address-dropdown-span">
        <button class="btn btn-secondary">
            <i class="fa fa-caret-down"></i>&nbsp;${t.addressText}
        </button></span>
        <div class="address-dropdown-content">
            <ul class="address-dropdown-element-wrapper">
                ${s}
            </ul>
        </div>
    `}function updateLastAddress(e){let r=Object(JSON.parse(localStorage.getItem("addresses")));r.forEach(t=>{t.addressId==e&&(r[0]={addressId:t.addressId,addressText:t.addressText})}),fillAddressDropdown(r),localStorage.setItem("addresses",JSON.stringify(r))}function addressDropdownListener(e){try{if(e.target.parentElement.matches(".address-dropdown-span")||e.target.matches(".address-dropdown-element-wrapper")||e.target.matches(".address-dropdown-element")){if(e.target.parentElement.matches(".address-dropdown-span")){let r=document.querySelector("#navbar-and-sidebar-wrapper > #main-navbar > header .address-dropdown > .address-dropdown-content");r.classList.toggle("show")}else if(e.target.classList.contains("address-dropdown-element")&&!e.target.classList.contains("active-address")){let t=e.target.dataset.addressId;updateLastAddress(t)}}else{let s=document.querySelector("#navbar-and-sidebar-wrapper > #main-navbar > header .address-dropdown > .address-dropdown-content");s.classList.remove("show")}}catch(a){console.log(a)}}function userDropdownListener(e){try{if(e.target.parentElement.matches(".user-dropdown-span")||e.target.matches(".user-dropdown-element-wrapper")||e.target.matches(".user-dropdown-element")||e.target.matches(".user-dropdown-button-icon")){if(e.target.matches(".user-dropdown-button-icon")){let r=document.querySelector("#navbar-and-sidebar-wrapper > #main-navbar > header .user-dropdown > .user-dropdown-content");r.classList.toggle("show")}else if(e.target.parentElement.matches(".user-dropdown-span")){let t=document.querySelector("#navbar-and-sidebar-wrapper > #main-navbar > header .user-dropdown > .user-dropdown-content");t.classList.toggle("show")}}else{let s=document.querySelector("#navbar-and-sidebar-wrapper > #main-navbar > header .user-dropdown > .user-dropdown-content");s.classList.remove("show")}}catch(a){console.log(a)}}function fetchShopsByCategoryListener(e){let r;try{e.target.matches(".fetch-category-link")?r=e.target.innerHTML:e.target.matches(".fetch-category-img")?r=e.target.nextSibling.innerHTML:e.target.matches(".fetch-category-wrapper")&&(r=e.target.childNodes[1].innerHTML),void 0!==r&&fetchShopsByCategory(r)}catch(t){console.log(console.log(t))}}class MainSidebar{constructor(e){this.element=document.getElementById(e),this.is_open=!1}openSidebar(){this.element.style.width="100%",this.is_open=!0}closeSidebar(){this.element.style.width="0%",this.is_open=!1}}function closeMainSidebar(){mainSidebar.closeSidebar()}function openMainSidebar(){mainSidebar.is_open?closeMainSidebar():mainSidebar.openSidebar()}let mainSidebar=new MainSidebar("main-sidebar");function fetchShopsByCategory(e){let r=JSON.parse(localStorage.getItem("addresses"))[0].addressText.split(",")[0].trim();window.location.href=`/search/categories/${e}?city=${r}`}document.getElementById("open-main-sidebar-btn").addEventListener("click",openMainSidebar),document.getElementById("close-main-sidebar-btn").addEventListener("click",closeMainSidebar),document.getElementById("sidebar-link-to-footer").addEventListener("click",closeMainSidebar),document.querySelector("#search-input").addEventListener("keydown",e=>{if("Enter"==e.code||13==e.keyCode){let r=e.target.value.trim(),t=JSON.parse(localStorage.getItem("addresses"))[0].addressText.split(",")[0].trim();r.length>0&&(window.location.href=`/search?searchInput=${r}&city=${t}`)}}),window.onclick=function(e){addressDropdownListener(e),fetchShopsByCategoryListener(e),userDropdownListener(e)},updateLocalStorage(),e(),r(),t();